# åˆ«åå¤„ç†æ”¹è¿›æ–‡æ¡£

## ğŸ“‹ é—®é¢˜æè¿°

AI æ¨¡å‹åœ¨è¾“å‡ºç¿»è¯‘ç»“æœæ—¶å¯èƒ½ä½¿ç”¨ä¸åŒçš„è¯­è¨€åˆ«åï¼Œå¯¼è‡´è§£æå™¨æ— æ³•æ­£ç¡®è¯†åˆ«å’Œåˆ†ç±»ç¿»è¯‘å†…å®¹ã€‚ä¾‹å¦‚ï¼š

### ğŸ” é—®é¢˜ç¤ºä¾‹

**é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸­æ–‡åˆ«åï¼š**
```yaml
- code: zh
  aliases: ["chinese", "ä¸­æ–‡", "æ±‰è¯­", "zh-cn"]
```

**AI å¯èƒ½çš„è¾“å‡ºå˜ä½“ï¼š**
```
åŸæ–‡: Hello world
ä¸­æ–‡: ä½ å¥½ä¸–ç•Œ        # âœ… æ ‡å‡†æ ¼å¼  
æ±‰è¯­: ä½ å¥½ä¸–ç•Œ        # âŒ ä¹‹å‰æ— æ³•è¯†åˆ«
Chinese: ä½ å¥½ä¸–ç•Œ     # âŒ ä¹‹å‰æ— æ³•è¯†åˆ«
zh-cn: ä½ å¥½ä¸–ç•Œ       # âŒ ä¹‹å‰æ— æ³•è¯†åˆ«
```

**ä¹‹å‰çš„é—®é¢˜ï¼š**
- åªæœ‰ "ä¸­æ–‡:" èƒ½è¢«æ­£ç¡®è¯†åˆ«å¹¶è½¬æ¢ä¸º `zh` é”®
- å…¶ä»–åˆ«åä¼šè¢«å¿½ç•¥ï¼Œå¯¼è‡´ `translations` å­—æ®µç¼ºå¤±å†…å®¹

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### 1. åŠ¨æ€ OutputRules ç”Ÿæˆ

**ä¹‹å‰ï¼šç¡¬ç¼–ç è§„åˆ™**
```go
OutputSection{
    Key: "ä¸­æ–‡",
    Aliases: []string{"Chinese", "ä¸­æ–‡", "æ±‰è¯­"}, // æœ‰é™çš„åˆ«å
    LanguageCode: "zh",
}
```

**ç°åœ¨ï¼šåŠ¨æ€ç”Ÿæˆ**
```go
func (e *Engine) buildDynamicOutputRules(targetLanguageCodes []string) OutputRules {
    // ä¸ºæ¯ä¸ªç›®æ ‡è¯­è¨€åŠ¨æ€åˆ›å»ºOutputSection
    for _, langCode := range targetLanguageCodes {
        if lang, ok := e.languages[langCode]; ok {
            // åŒ…å«é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰åˆ«å
            aliases := []string{}
            
            // æ·»åŠ æ‰€æœ‰namesä¸­çš„å€¼
            for _, name := range lang.Names {
                aliases = append(aliases, name)
            }
            
            // æ·»åŠ é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰åˆ«å
            aliases = append(aliases, lang.Aliases...)
            
            // æ·»åŠ è¯­è¨€ä»£ç æœ¬èº«
            aliases = append(aliases, lang.Code, strings.ToUpper(lang.Code))
        }
    }
}
```

### 2. åŒé‡åŒ¹é…æœºåˆ¶

**è§£ææµç¨‹ï¼š**
```go
// 1. é¦–å…ˆå°è¯• OutputRules åŒ¹é…
for _, sectionRule := range rules.Sections {
    if matchFound {
        finalSections[sectionRule.LanguageCode] = value
        // âœ… é€šè¿‡åŠ¨æ€è§„åˆ™åŒ¹é…æˆåŠŸ
    }
}

// 2. å›é€€åˆ°é€šç”¨è¯­è¨€è¯†åˆ«
if !foundRule {
    if langCode, err := e.identifyLanguageFromText(keyFromLLM); err == nil {
        finalSections[langCode] = value
        // âœ… é€šè¿‡å›é€€æœºåˆ¶åŒ¹é…æˆåŠŸ
    }
}
```

### 3. é€šç”¨è¯­è¨€è¯†åˆ«

**æ”¯æŒçš„åŒ¹é…ç±»å‹ï¼š**
- **ç²¾ç¡®åŒ¹é…**ï¼š`"ä¸­æ–‡"` â†’ `zh`
- **åˆ«ååŒ¹é…**ï¼š`"æ±‰è¯­"` â†’ `zh`  
- **ä»£ç åŒ¹é…**ï¼š`"zh-cn"` â†’ `zh`
- **éƒ¨åˆ†åŒ¹é…**ï¼š`"è‹±è¯­ç¿»è¯‘"` â†’ `en`

## ğŸ“Š æ”¹è¿›æ•ˆæœ

### ç°åœ¨æ”¯æŒçš„æ‰€æœ‰åˆ«å

**ä¸­æ–‡ (zh):**
- âœ… `ä¸­æ–‡` (display name)
- âœ… `Chinese` (english name)  
- âœ… `chinese` (alias)
- âœ… `æ±‰è¯­` (alias)
- âœ… `zh-cn` (alias)
- âœ… `zh` (code)
- âœ… `ZH` (upper code)

**è‹±æ–‡ (en):**
- âœ… `è‹±æ–‡` (display name)
- âœ… `English` (english name)
- âœ… `english` (alias)
- âœ… `è‹±è¯­` (alias)
- âœ… `en` (code)
- âœ… `EN` (upper code)

**ç¹ä½“ä¸­æ–‡ (zh-hant):**
- âœ… `ç¹é«”ä¸­æ–‡` (display name)
- âœ… `Traditional Chinese` (english name)
- âœ… `zh-tw` (alias)
- âœ… `zh-hk` (alias)
- âœ… `traditional chinese` (alias)
- âœ… `ç¹ä½“ä¸­æ–‡` (alias)
- âœ… `zh-hant` (code)

**æ—¥æ–‡ (ja):**
- âœ… `æ—¥æ–‡` (display name)
- âœ… `Japanese` (english name)
- âœ… `japanese` (alias)
- âœ… `æ—¥è¯­` (alias)
- âœ… `æ—¥æœ¬èª` (alias)
- âœ… `ja` (code)
- âœ… `JA` (upper code)

**éŸ©æ–‡ (ko):**
- âœ… `éŸ©æ–‡` (display name)
- âœ… `Korean` (english name)
- âœ… `korean` (alias)
- âœ… `éŸ©è¯­` (alias)
- âœ… `í•œêµ­ì–´` (alias)
- âœ… `ko` (code)
- âœ… `KO` (upper code)

**è¥¿ç­ç‰™è¯­ (es):**
- âœ… `è¥¿ç­ç‰™è¯­` (display name)
- âœ… `Spanish` (english name)
- âœ… `spanish` (alias)
- âœ… `espaÃ±ol` (alias)
- âœ… `es` (code)
- âœ… `ES` (upper code)

**æ³•è¯­ (fr):**
- âœ… `æ³•è¯­` (display name)
- âœ… `French` (english name)
- âœ… `french` (alias)
- âœ… `franÃ§ais` (alias)
- âœ… `fr` (code)
- âœ… `FR` (upper code)

**å¾·è¯­ (de):**
- âœ… `å¾·è¯­` (display name)
- âœ… `German` (english name)
- âœ… `german` (alias)
- âœ… `deutsch` (alias)
- âœ… `de` (code)
- âœ… `DE` (upper code)

**ä¿„è¯­ (ru):** ğŸ†•
- âœ… `ä¿„è¯­` (display name)
- âœ… `Russian` (english name)
- âœ… `russian` (alias)
- âœ… `ä¿„æ–‡` (alias)
- âœ… `ä¿„ç½—æ–¯è¯­` (alias)
- âœ… `Ğ ÑƒÑÑĞºĞ¸Ğ¹` (native name)
- âœ… `ru` (code)
- âœ… `RU` (upper code)

**æ„å¤§åˆ©è¯­ (it):** ğŸ†•
- âœ… `æ„å¤§åˆ©è¯­` (display name)
- âœ… `Italian` (english name)
- âœ… `italian` (alias)
- âœ… `æ„å¤§åˆ©æ–‡` (alias)
- âœ… `Italiano` (native name)
- âœ… `it` (code)
- âœ… `IT` (upper code)

### æµ‹è¯•æ¡ˆä¾‹

**è¾“å…¥ç¤ºä¾‹ï¼š**
```
åŸæ–‡: Hello world
æ±‰è¯­: ä½ å¥½ä¸–ç•Œ
English: Hello world  
ç¹ä½“ä¸­æ–‡: ä½ å¥½ä¸–ç•Œ
ä¿„è¯­: ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ Ğ¼Ğ¸Ñ€
italian: Ciao mondo
```

**è¾“å‡ºç»“æœï¼š**
```json
{
  "transcription": "Hello world",
  "translations": {
    "zh": "ä½ å¥½ä¸–ç•Œ",        // âœ… "æ±‰è¯­" â†’ "zh"
    "en": "Hello world",    // âœ… "English" â†’ "en"  
    "zh-hant": "ä½ å¥½ä¸–ç•Œ",  // âœ… "ç¹ä½“ä¸­æ–‡" â†’ "zh-hant"
    "ru": "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ Ğ¼Ğ¸Ñ€",     // âœ… "ä¿„è¯­" â†’ "ru"
    "it": "Ciao mondo"      // âœ… "italian" â†’ "it"
  }
}
```

### å®é™…æµ‹è¯•éªŒè¯

**1. ä¿„è¯­ç¿»è¯‘æµ‹è¯•ï¼š**
```bash
curl -X POST -H "X-API-Key: dev-key-123" \
  -F "audio=@test.wav" \
  -F "task=translate" \
  -F "target_languages=ru" \
  http://localhost:8080/api/v1/process
```

**å“åº”ï¼š**
```json
{
  "transcription": "äº²çˆ±çš„å¬ä¼—ï¼Œä½ å¥½ï¼Œæˆ‘ç°åœ¨æ˜¯åœ¨ç”¨è¯­éŸ³ç¿»è¯‘ã€‚",
  "translations": {
    "ru": "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ ÑĞ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸, Ğ·Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ, Ñ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‡Ğ¸Ğº."
  }
}
```

**2. æ„å¤§åˆ©è¯­ç¿»è¯‘æµ‹è¯•ï¼š**
```bash
curl -X POST -H "X-API-Key: dev-key-123" \
  -F "audio=@test.wav" \
  -F "task=translate" \
  -F "target_languages=it" \
  http://localhost:8080/api/v1/process
```

**å“åº”ï¼š**
```json
{
  "transcription": "å—¯ï¼Œäº²çˆ±çš„å¬ä¼—æ‚¨å¥½ï¼Œæˆ‘ç°åœ¨æ˜¯åœ¨ç”¨è¯­éŸ³ç¿»è¯‘ã€‚",
  "translations": {
    "it": "Ehi, cari ascoltatori, sto usando la traduzione vocale."
  }
}
```

**3. å¤šè¯­è¨€ç»„åˆæµ‹è¯•ï¼š**
```bash
curl -X POST -H "X-API-Key: dev-key-123" \
  -F "audio=@test.wav" \
  -F "task=translate" \
  -F "target_languages=en,ru,it" \
  http://localhost:8080/api/v1/process
```

**å“åº”ï¼š**
```json
{
  "transcription": "å—¯ï¼Œäº²çˆ±çš„å¬ä¼—æ‚¨å¥½ï¼Œæˆ‘ç°åœ¨æ˜¯åœ¨ç”¨è¯­éŸ³ç¿»è¯‘ã€‚",
  "translations": {
    "en": "Hello, dear listeners, I am now using voice translation.",
    "ru": "Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ ÑĞ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸, Ñ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´.",
    "it": "Ciao, cari ascoltatori, sto usando ora il traduttore vocale."
  }
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å…³é”®æ”¹è¿›ç‚¹

1. **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰åˆ«åéƒ½æ¥è‡ªé…ç½®æ–‡ä»¶ï¼Œä¸å†ç¡¬ç¼–ç 
2. **åŠ¨æ€ç”Ÿæˆ**ï¼šæ ¹æ®è¯·æ±‚çš„ç›®æ ‡è¯­è¨€åŠ¨æ€æ„å»ºè§£æè§„åˆ™
3. **åŒé‡ä¿é™©**ï¼šOutputRules + å›é€€æœºåˆ¶ç¡®ä¿ä¸ä¸¢å¤±ä»»ä½•ç¿»è¯‘
4. **ç²¾ç¡®åŒ¹é…**ï¼šæ”¹è¿›çš„åŒ¹é…ç®—æ³•ä¼˜å…ˆé€‰æ‹©æœ€ç²¾ç¡®çš„åŒ¹é…

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
prompt:
  languages:
    - code: zh
      names:
        display: "ä¸­æ–‡"
        english: "Chinese"
        native: "ä¸­æ–‡"
      aliases: ["chinese", "ä¸­æ–‡", "æ±‰è¯­", "zh-cn"]
    
    - code: en  
      names:
        display: "è‹±æ–‡"
        english: "English"
        native: "English"
      aliases: ["english", "è‹±æ–‡", "è‹±è¯­"]
```

### æ—¥å¿—ç›‘æ§

```json
{
  "level": "debug",
  "msg": "Converted LLM key to language code",
  "llmKey": "æ±‰è¯­",
  "finalKey": "zh", 
  "method": "outputrules"
}

{
  "level": "debug", 
  "msg": "Converted LLM key to language code using fallback",
  "llmKey": "zh-cn",
  "finalKey": "zh",
  "method": "fallback_language_identification"
}
```

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ªæ”¹è¿›ï¼Œç³»ç»Ÿç°åœ¨èƒ½å¤Ÿï¼š

1. **âœ… ç¨³å®šè¯†åˆ«**ï¼šæ— è®ºAIè¾“å‡ºä»€ä¹ˆåˆ«åï¼Œéƒ½èƒ½æ­£ç¡®è¯†åˆ«
2. **âœ… ç»Ÿä¸€è¾“å‡º**ï¼šå§‹ç»ˆè¿”å›æ ‡å‡†çš„è¯­è¨€ä»£ç ä½œä¸ºé”® (`zh`, `en`, `ja`, `ru`, `it` ç­‰)
3. **âœ… é…ç½®é©±åŠ¨**ï¼šæ·»åŠ æ–°è¯­è¨€æˆ–åˆ«ååªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶
4. **âœ… å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œçº¯å¢å¼º
5. **âœ… ç›‘æ§å‹å¥½**ï¼šè¯¦ç»†çš„æ—¥å¿—è®°å½•ä¾¿äºè°ƒè¯•
6. **âœ… å¤šè¯­è¨€æ”¯æŒ**ï¼šç°åœ¨æ”¯æŒ **10ç§è¯­è¨€**ï¼ŒåŒ…æ‹¬æ–°å¢çš„ä¿„è¯­ğŸ‡·ğŸ‡ºå’Œæ„å¤§åˆ©è¯­ğŸ‡®ğŸ‡¹

### ğŸ“‹ å®Œæ•´æ”¯æŒçš„è¯­è¨€åˆ—è¡¨

| è¯­è¨€ä»£ç  | æ˜¾ç¤ºåç§° | è‹±æ–‡åç§° | åŸç”Ÿåç§° | çŠ¶æ€ |
|---------|---------|---------|---------|------|
| `zh` | ä¸­æ–‡ | Chinese | ä¸­æ–‡ | âœ… |
| `zh-hant` | ç¹é«”ä¸­æ–‡ | Traditional Chinese | ç¹é«”ä¸­æ–‡ | âœ… |
| `en` | è‹±æ–‡ | English | English | âœ… |
| `ja` | æ—¥æ–‡ | Japanese | æ—¥æœ¬èª | âœ… |
| `ko` | éŸ©æ–‡ | Korean | í•œêµ­ì–´ | âœ… |
| `es` | è¥¿ç­ç‰™è¯­ | Spanish | EspaÃ±ol | âœ… |
| `fr` | æ³•è¯­ | French | FranÃ§ais | âœ… |
| `de` | å¾·è¯­ | German | Deutsch | âœ… |
| `ru` | ä¿„è¯­ | Russian | Ğ ÑƒÑÑĞºĞ¸Ğ¹ | ğŸ†• |
| `it` | æ„å¤§åˆ©è¯­ | Italian | Italiano | ğŸ†• |

**æ ¸å¿ƒä»·å€¼ï¼š** ç¡®ä¿ `translations` å­—æ®µå§‹ç»ˆåŒ…å«å®Œæ•´çš„ç¿»è¯‘å†…å®¹ï¼Œæé«˜APIçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ç°åœ¨æ”¯æŒæ›´å¤šè¯­è¨€ï¼Œæ»¡è¶³æ›´å¹¿æ³›çš„å›½é™…åŒ–éœ€æ±‚ï¼ 